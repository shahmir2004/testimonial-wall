<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Password Reset</title>
</head>
<body>
    <h1>Password Reset Link Debug</h1>
    <div id="info"></div>
    
    <script>
        // Parse the recovery URL for debugging
        const recoveryUrl = "https://lermiyxzvecvhdolzmoa.supabase.co/auth/v1/verify?token=c4640bfc42b06fd66137e77055a4ad1a90f3b24e251d9031fbc2147c&type=recovery&redirect_to=http://localhost:5173/update-password";
        
        // Parse the current page URL
        const currentUrl = window.location.href;
        const hash = window.location.hash;
        const search = window.location.search;
        
        const info = document.getElementById('info');
        info.innerHTML = `
            <h2>Recovery Link Analysis:</h2>
            <p><strong>Original Recovery URL:</strong><br>${recoveryUrl}</p>
            
            <h2>Current Page URL:</h2>
            <p><strong>Full URL:</strong> ${currentUrl}</p>
            <p><strong>Hash:</strong> ${hash}</p>
            <p><strong>Search:</strong> ${search}</p>
            
            <h2>Recovery URL Parameters:</h2>
        `;
        
        // Parse the original recovery URL
        try {
            const recoveryUrlObj = new URL(recoveryUrl);
            const recoveryParams = recoveryUrlObj.searchParams;
            
            info.innerHTML += '<h3>From Recovery Link:</h3>';
            for (const [key, value] of recoveryParams) {
                info.innerHTML += `<p><strong>${key}:</strong> ${decodeURIComponent(value)}</p>`;
            }
        } catch (e) {
            info.innerHTML += '<p>Error parsing recovery URL</p>';
        }
        
        info.innerHTML += '<h2>Current Page Parameters:</h2>';
        
        // Parse hash parameters from current page
        if (hash) {
            info.innerHTML += '<h3>From Hash (#):</h3>';
            const hashParams = new URLSearchParams(hash.substring(1));
            for (const [key, value] of hashParams) {
                info.innerHTML += `<p><strong>${key}:</strong> ${decodeURIComponent(value)}</p>`;
            }
        }
        
        // Parse search parameters from current page
        if (search) {
            info.innerHTML += '<h3>From Query String (?):</h3>';
            const searchParams = new URLSearchParams(search);
            for (const [key, value] of searchParams) {
                info.innerHTML += `<p><strong>${key}:</strong> ${decodeURIComponent(value)}</p>`;
            }
        }
        
        // Add recommendations
        info.innerHTML += `
            <h2>Diagnosis:</h2>
            <div style="background: #f0f9ff; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                <h3>What should happen:</h3>
                <ol>
                    <li>You click the recovery link</li>
                    <li>Supabase verifies the token</li>
                    <li>Supabase redirects to: <code>http://localhost:5173/update-password</code></li>
                    <li>The redirect should include tokens in the URL hash like: <code>#access_token=xxx&refresh_token=yyy&type=recovery</code></li>
                </ol>
                
                <h3>What's actually happening:</h3>
                <p>The redirect is coming with error parameters instead of tokens, suggesting the token has already expired by the time you click it.</p>
                
                <h3>Next Steps:</h3>
                <p><strong>Test this:</strong> Copy the recovery URL above and paste it directly into a new browser tab <em>immediately</em> after receiving the email (within 30 seconds).</p>
            </div>
        `;
    </script>
</body>
</html>
